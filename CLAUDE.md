# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Chinese language creative writing project called "GPT Story Maker" - a light novel/web novel with a complex multi-dimensional storyline. The protagonist Lin Wanwan is a medical student who transmigrates into a cultivation world and develops the ability to summon multiple versions of herself from parallel realities through quantum superposition states.

## Repository Structure

```
├── Vol1/          # Detailed plot design for chapters 1-20
├── Vol2/          # Detailed plot design for chapters 21-40  
├── Vol3/          # Detailed plot design for chapters 41-60
├── Vol4/          # (Reserved for chapters 61-80)
├── Vol5/          # (Reserved for chapters 81-100)
└── 设定/           # Story settings and design documents
    ├── 写作规范.md           # Centralized writing standards and style guidelines (PRIORITY)
    ├── 大纲.md              # Master outline with world-building and character designs
    ├── 人格机制设定.md       # Personality mechanism settings
    ├── 人格图鉴.md           # Character personality profiles  
    ├── 人物档案.md           # Character development tracking
    ├── 伏笔追踪表.md         # Foreshadowing tracking table
    ├── 背景势力设定.md       # Faction and power structure definitions
    └── 章节创作检查清单模板.md # Structured quality control checklist template
```

## Story Architecture

**Core Concept**: Quantum superposition mechanics where the protagonist exists in multiple states simultaneously, manifesting as up to 42 different personalities/versions of herself.

**Key Elements**:
- Multi-dimensional personality system based on quantum mechanics
- Cultivation world setting with modern scientific knowledge integration
- Progressive power system tied to cultivation realms (Qi Refinement → Foundation Building → Golden Core → Nascent Soul)
- Philosophical themes around identity, choice, and the nature of existence
- The number "42" as a central motif (reference to Hitchhiker's Guide to the Galaxy)

## Core Characters

- **Lin Wanwan (Original)**: Medical student protagonist with social anxiety and hoarding tendencies
- **Personality #1**: Yandere version from dating sim world
- **Personality #2**: Foodie version from culinary world  
- **Personality #7**: Mathematician version focused on calculations
- **Personality #21**: 5-year-old child version representing innocence
- **Personality #35**: Lawyer version focused on justice
- **Personality #42**: The "Answer Keeper" who knows ultimate truths but speaks in riddles
- **System 009**: Malfunctioning cultivation system with multiple personality disorder
- **The Unifier (Chen Yi)**: Main antagonist who seeks to eliminate all possibilities except one

## Writing Guidelines

**Language**: All content is in Chinese (Simplified)
**Genre**: Light novel/web novel with elements of:
- Xianxia (Cultivation fiction)
- Comedy/slice of life
- Science fiction concepts
- Philosophical exploration
- Action/adventure

**Tone**: Balances humor with deeper philosophical themes. Contains both lighthearted personality interactions and serious existential questions.

## Document Hierarchy and Management

**Authority Structure**:
- **设定/写作规范.md** - Centralized writing standards and style guidelines (PRIMARY reference for all writing rules)
- **设定/大纲.md** - Master story outline and world-building (takes precedence for plot/setting conflicts)  
- **设定/人格图鉴.md** - Character personality profiles with flexible management
- **设定/伏笔追踪表.md** - Plot thread and foreshadowing tracking across all story arcs
- **设定/背景势力设定.md** - Faction relationships and power structures
- **Vol directories** - Detailed chapter-by-chapter breakdowns

**Document Index System**:
- **设定/内容索引.md** - Master content index for precise navigation
  - TOC section: Lists files with their index line ranges
  - File sections: Lists chapters with original file line ranges  
  - Usage: Use Read tool with specific line numbers for accurate content extraction
  - Generated by: `tools/generate_index.py` (excludes story chapters, settings only)
  - **CRITICAL**: Must regenerate index after ANY settings file modification
  - Automation: Use git hooks and CI hooks to ensure index stays current

**Consistency Rules**:
- All story documents are in Markdown format  
- Character names and terminology must remain consistent across all files
- Writing standards and style: 设定/写作规范.md takes precedence
- Plot and world-building conflicts: 设定/大纲.md takes precedence
- New personality additions should immediately update both 人格图鉴.md and 伏笔追踪表.md
- Timeline discrepancies should be resolved using the outline's chapter structure

## Key Story Mechanics

**Personality System**: 
- Core personalities: #1 (Yandere), #2 (Foodie), #7 (Mathematician), #21 (Child), #35 (Lawyer), #42 (Answer Keeper)
- Each personality represents a different "way of understanding the universe"
- Power scaling tied to cultivation realms with realistic multipliers (1.8x-8x max)
- Internal meeting space allows personalities to collaborate in accelerated time

**Plot Structure**:
- 5 volumes of 20 chapters each (100 chapters total)
- Quantum mechanics integrated with cultivation world logic
- Philosophical themes around identity, choice, and observer effect
- Multiple antagonist factions with different ideologies

## AI-Assisted Workflow

This project uses a specialized AI agent for comprehensive quality assurance:

**Available Agent**:
- `comprehensive-story-checker`: Unified quality validation system that performs:
  - Settings compliance verification (against 设定/大纲.md and 设定/写作规范.md)
  - Character authenticity checking (dialogue consistency, personality voices)
  - Narrative coherence validation (scene transitions, plot logic)
  - Humor/philosophy balance assessment

**Quality Assurance Process**:
1. Generate/modify story content
2. Review and request plot/character adjustments  
3. Use comprehensive-story-checker for complete validation
4. Agent automatically reads latest standards from 设定/写作规范.md before each check

## Development Notes

This is a pure creative writing project with no executable code. When working with these files, focus on:
- Maintaining narrative consistency across all setting documents
- Preserving distinct character voices for each personality
- Tracking plot threads and foreshadowing elements using 伏笔追踪表.md
- Ensuring philosophical themes remain coherent throughout the story
- Balancing humor with deeper existential questions
- You should always use chinese in the main text
- Update character lists as story develops
- You need to control each chapter to above 2000 words
- Pay attention to the plot's pacing, maintain appropriate suspense between chapters, and arouse the reader's desire to read
- **数字使用规范**：人格编号统一使用中文数字（小一、小二、小七、二十一号、三十五号、四十二号），不使用阿拉伯数字

## Index Maintenance

**⚠️ MANDATORY**: Regenerate `设定/内容索引.md` after ANY settings file modification:

**Manual Update**:
```bash
python tools/generate_index.py
```

**Recommended Automation**:
1. **Git Pre-commit Hook**: Auto-regenerate index before commits
2. **CI/CD Pipeline**: Validate index is current on pull requests  
3. **IDE Integration**: Auto-update on file save (optional)

**Git Hook Status**: ✅ **ACTIVE**
- Pre-commit hook automatically regenerates index before every commit
- No manual intervention required - runs transparently
- CI workflow validates index consistency on pull requests

## Writing Standards Reference

**⚠️ CRITICAL**: Always refer to `设定/写作规范.md` for complete and current writing standards. Key points:

- **System009 Dialogue Format**: 系统009【对话内容】 (no quotation marks)
- **Character Nicknames**: Other characters may call system "系统" or "009" in dialogue  
- **Personality Numbers**: Use Chinese numerals (小一、小二、小七、二十一号、三十五号、四十二号)
- **Language Rules**: 
  - Lin Wanwan: Modern terms internally, cultivation terms externally
  - Cultivation world characters: Strict Daoist terminology only
  - Personality #7: Scientific terms with cultivation physics vocabulary
- **Chapter Requirements**: Minimum 2000 characters, avoid unnecessary metadata
- **Title Diversity**: Avoid repetitive "XX的XX" format, use varied styles

## Chapter Writing Workflow

**⚠️ 强制执行三层质量保障体系**：

### 第一层：预创作验证 (Pre-Writing Validation)
**MANDATORY DOCUMENT CHECK ORDER** before writing any chapters:

#### Essential Documents (Must Check First):
1. **设定/写作规范.md** - PRIMARY authority for all writing standards, language rules, character dialogue formats
2. **设定/大纲.md** - Core world-building, character settings, and overall plot structure  
3. **Vol[X]/第[X]卷详细剧情设计.md** - Specific detailed plot design for that volume (TAKES PRECEDENCE over general outline)
4. **设定/伏笔追踪表.md** - Track what foreshadowing has been set up and what needs to be resolved
5. **设定/章节创作检查清单模板.md** - Use structured checklist for systematic validation

#### Supporting Documents:
6. **设定/人格图鉴.md** - Character personality profiles and awakening timelines
7. **Previous chapters** - Understand current story state and character knowledge
8. **设定/人物档案.md** - Character development tracking
9. **设定/背景势力设定.md** - Faction relationships if relevant

### 第二层：创作过程约束 (In-Process Constraints)
- **Language Rules Enforcement**: Real-time validation of dialogue formats and terminology
- **Plot Progression Control**: Each scene must serve a clear narrative purpose
- **Character Consistency Check**: Behavior and dialogue must match established personalities
- **Pacing Monitor**: Balance action, dialogue, and internal monologue

### 第三层：后创作验证 (Post-Writing Validation)
- **Technical Compliance**: Word count, formatting, title diversity
- **Content Coherence**: Logic consistency, character knowledge states
- **Quality Standards**: Plot advancement, character development, style adherence
- **AI Agent Validation**: Use comprehensive-story-checker for final verification

### Critical Implementation Rules:
- **MANDATORY**: Use 设定/章节创作检查清单模板.md for EVERY chapter
- **NEVER** assume plot details from the general outline alone
- **ALWAYS** check if there's a specific detailed plot design file first
- **ALWAYS** verify character awakening timelines and current knowledge states
- **ALWAYS** follow 写作规范.md for language, format, and style requirements
- **The detailed plot design takes precedence over the general outline** for specific chapter content
- **Complete all three validation layers before considering any chapter finished**

**Before any writing/editing task**: Complete the full three-layer validation workflow above
